<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&family=Notable&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoGoL - Go Web Crawler Search</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
            text-align: center;
        }

        h1 {
            color: #ffad0a;
            margin-bottom: 20px;
            font-style: bold;
            font-size: 60px;
            font-family: 'Notable', sans-serif;
        }

        #search-box {
            width: 100%;
            max-width: 500px;
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 24px;
            outline: none;
            transition: border-color 0.3s;
        }

        #search-box:focus {
            border-color: #007bff;
        }

        #results {
            margin-top: 30px;
            text-align: left;
        }

        .result-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .result-title {
            font-size: 18px;
            color: #1a0dab;
            text-decoration: none;
        }

        .result-title:hover {
            text-decoration: underline;
        }

        .result-url {
            font-size: 14px;
            color: #006621;
            margin-bottom: 4px;
        }

        .result-snippet {
            font-size: 14px;
            color: #545454;
            line-height: 1.4;
        }

        .stats {
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>

<body>
    <h1>GoGoL</h1>
    <input type="text" id="search-box" placeholder="Search for keywords (e.g., 'concurrency')..." autofocus>
    <div class="stats" id="stats"></div>
    <div id="results"></div>

    <script>
        const searchBox = document.getElementById('search-box');
        const resultsDiv = document.getElementById('results');
        const statsDiv = document.getElementById('stats');

        searchBox.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                performSearch(this.value);
            }
        });

        async function performSearch(query) {
            if (!query) return;
            resultsDiv.innerHTML = '<p>Searching...</p>';
            try {
                const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                resultsDiv.innerHTML = '';
                if (!data || data.length === 0) {
                    resultsDiv.innerHTML = '<p>No results found.</p>';
                    return;
                }

                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.innerHTML = `
                        <div class="result-url">${escapeHtml(item.url)}</div>
                        <a href="${escapeHtml(item.url)}" class="result-title" target="_blank">${escapeHtml(item.title || 'No Title')}</a>
                        <div class="result-snippet">${formatSnippet(item.snippet)}</div>
                    `;
                    resultsDiv.appendChild(div);
                });
            } catch (err) {
                resultsDiv.innerHTML = `<p style="color:red">Error: ${err.message}</p>`;
            }
        }

        async function loadStats() {
            try {
                const res = await fetch('/stats');
                const data = await res.json();
                statsDiv.innerText = `Indexed ${data.total_pages} pages | ${data.total_terms} terms`;
            } catch (e) { console.error(e); }
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        function formatSnippet(snippet) {
            if (!snippet) return '';
            return escapeHtml(snippet).replace(/\*\*(.*?)\*\*/g, '<mark>$1</mark>');
        }

        loadStats();
    </script>
</body>

</html>